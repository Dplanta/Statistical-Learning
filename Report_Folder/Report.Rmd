---
title: "Titolo del progetto"
author: "Domenico Plantamura, Eduardo David Lotto, Manuel D'Alterio Grazioli, Gabriele Fugagnoli"
font: 12pt
output:
  html_document:
    toc: true
    # number_sections: true
  pdf_document:
    toc: true
    # number_sections: true
  word_document:
    toc: true
    # number_sections: true
---


```{r setup, include = FALSE}

knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())

```


\

# Introduction

## Objective of the project

Our goal is to investigate whether the salaries earned by the NBA players during the 2023-2024 season are fair in proportion to their performance during the current year's Regular season. To analyse performance, we selected several statistics: from the most common such as points, rebounds, assists to advanced metrics like Usage, Player Impact Estimated and Winning Shares. 
The idea is to deep dive into the relationship between salaries and performance through different models in order to understand what kind of relationship there is and which model best fits the data. 
Finally, we will compare actual salaries with those predicted by our models to find out which players (according to the models) are the most overpaid or underpaid.

*AGGIUNGERE DETTAGLI E SPIEGARE IN SINTESI IL WEB SCRAPING REALIZZATO*

## Steps followed

To perform our analysis we followed these steps:

1.  Data collection;

2.  Data exploration;

3.  Analysis;

4.  Interpretation.

We now explain in depth each step.

\

## Data collection

We performed a web scraping operation from the [Official NBA Stats](https://www.nba.com/stats) website, from which we collected most of the stats. Additionally, we downloaded data about the salaries from [Hoopshype](https://hoopshype.com/) and other stats of interest from [Basketball reference](https://www.basketball-reference.com). 
All data concerns the 2023-2024 NBA Regular Season. 

#### Why consider only Regular Season data?

Considering only data about Regular Season without considering players performance during playoffs limits a bit the potential of our analysis. On one hand, it's reasonable to infer that player performance during playoffs should have an important weight in determining his salary. On the other hand, considering playoffs in the analysis carries different issues. 
There are teams (and consequently players) that go further than others: 14 out of 30 teams can't qualify for the playoffs. For the teams which qualify, playoff stats are calculated on a number of games that could differ greatly between different teams (e.g. if a team loses in the first round, it plays from 4 to 7 games. If a team reaches the finals, it plays from 16 to 28 games). During Regular Season every team plays a fixed number of games, 82. 
Additionally, coaches usually rotate players at their disposal in a different way during playoffs: for instance, during regular season approximately 10-12 players for each team take part in the game; during playoffs it is not uncommon to observe only 7-8 players that come into play for each team. Furthermore, usually in a playoff game the best players are more involved compared to Regular season games. It means that, first of all, they play several more minutes. Moreover, they have the ball in their hands for a lot of time and consequently their stats grow a lot; hence, it could happen that a few players record a large part of the entire team's statistics. Considering this, including playoffs data in the analysis could lead to an overestimation of performance of 2-3 players and to an underestimation of the performance of the rest of the team.

All in all, it is undeniable that playoffs are a fundamental part of the season. It is also obvious that if a player has more responsabilities in that phase he probably deserves a higher salary. But we think that for the purposes of our analysis, the addition of statistics collected on a small sample of matches, different for practically every team, with highly polarised data between the various players may lead to biases if not handled properly. 
We think that considering only the regular season, although leading to a limited analysis, may be sufficient to grasp the main relationships between salaries and performance.


### Glossary

-	PLAYER NAME: players’ name
-	SALARY: salary earned by a player for 2023-2024 season (collected from hoopshype)
-	AGE: players’ age
-	POS: “Position”, states the playing position of a player

TRADITIONAL STATS (collected from NBA.com)

-	GP: “Games played”, the number of games played by a player during the 2023-2024 regular season
-	FG_PCT: “Field Goal Percentage”, The percentage of field goal attempts that a player makes. Formula: (FGM)/(FGA)
-	FG3_PCT: “3 Points “Field Goal Percentage”, The percentage of 3pt field goal attempts that a player makes. 
-	FT_PCT: “Free throws Percentage”, the percentage of free throws attempts that a player makes
-	OREB: “Offensive Rebounds”, The number of rebounds a player or team has collected while they were on offense
-	DREB: “Defensive Rebounds”, The number of rebounds a player or team has collected while they were on defense
-	REB: “Rebounds”; A rebound occurs when a player recovers the ball after a missed shot. This statistic is the number of total rebounds a player or team has collected on either offense or defense
-	AST: “Assists”, The number of assists -- passes that lead directly to a made basket -- by a player
-	TOV: “Turnovers”; A turnover occurs when the player or team on offense loses the ball to the defense
-	STL: “Steals”, Number of times a defensive player or team takes the ball from a player on offense, causing a turnover
-	BLK: “Blocks”, A block occurs when an offensive player attempts a shot, and the defense player tips the ball, blocking their chance to score
-	BLKA: “Blocks Against”, The number of shots attempted by a player or team that are blocked by a defender
-	PF: “Personal fouls”, The number of personal fouls a player or team committed
-	PFD: “Personal fouls drawn”, The number of personal fouls that are drawn by a player or team
-	PTS: “Points”, the number of points scored by a player
-	MIN: “Minutes played”, number of minutes played by a player during the 2023-2024 Regular season
-	MIN_G: “Minutes played per game”

ADVANCED STATS (collected from NBA.com)

-	OFF_RATING: “Offensive Rating”, Measures a team's points scored per 100 possessions. On a player level this statistic is team points scored per 100 possessions while they are on court. Formula: 100*((Points)/(POSS)
-	DEF_RATING: “Defensive Rating”, The number of points allowed per 100 possessions by a team. For a player, it is the number of points per 100 possessions that the team allows while that individual player is on the court. Formula: 100*((Opp Points)/(Opp POSS))
-	NET_RATING: “Net Rating”, Measures a team's point differential per 100 possessions. On player level this statistic is the team's point differential per 100 possessions while they are on court. Formula: OFFRTG - DEFRTG
-	AST_TO: “Assist to Turnover Ratio”, The number of assists for a player or team compared to the number of turnovers they have committed
-	TS_PCT: “True Shooting Percentage”, A shooting percentage that factors in the value of three-point field goals and free throws in addition to conventional two-point field goals. Formula: Points/ [2*(Field Goals Attempted+0.44*Free Throws Attempted)]
-	USG_PCT: “Usage Percentage”, The percentage of team plays used by a player when they are on the floor. Formula: (FGA + Possession Ending FTA + TO) / POSS
-	PIE: “Player Impact Estimate”, PIE measures a player's overall statistical contribution against the total statistics in games they play in. PIE yields results which are comparable to other advanced statistics (e.g. PER) using a simple formula. Formula: (PTS + FGM + FTM - FGA - FTA + DREB + (.5 * OREB) + AST + STL + (.5 * BLK) - PF - TO) / (GmPTS + GmFGM + GmFTM - GmFGA - GmFTA + GmDREB + (.5 * GmOREB) + GmAST + GmSTL + (.5 * GmBLK) - GmPF - GmTO)

The stats below are collected from Basketball reference:

-	WS: “Win Shares”; Win Shares is a player statistic which attempts to divvy up credit for team success to the individuals on the team. It is calculated using player, team and league-wide statistics and the sum of player win shares on a given team will be roughly equal to that team’s win total for the season (more details here https://www.basketball-reference.com/about/ws.html).
-	BPM: “Box Plus/Minus”; a box score estimate of the points per 100 possessions that a player contributed above a league-average player, translated to an average team
-	VORP: “Value Over Replacement Player”; a box score estimate of the points per 100 TEAM possessions that a player contributed above a replacement-level (-2.0) player, translated to an average team and prorated to an 82-game season. Multiply by 2.70 to convert to wins over replacement.

BPM and VORP are calculated per 100 possessions; MIN and WS are calculated over the whole regular season, MIN_G is calculated per game. The other stats are considered per 48 minutes.



*AGGIUNGERE DETTAGLI, LE ROBE DEI 48 MINUTI ETC ETC, qui c'è davvero molto da scrivere da quanto ho capito ed è uno dei punti forti del progetto*

## Data integration and cleaning

*Spiegare tutta la roba di come si sono unite le tabelle, aggiustato i dati come i nomi etc etc*



```{r useful-code, include=FALSE}

library(readxl)
data_salary <- read_excel("./data/NBA_players_salaries_HH.xlsx")
data_traditional_per48 <- read.csv("./data/RS_traditional_per48.csv")
data_traditional_tot <- read.csv("./data/RS_traditional_TOTALS.csv")
data_advanced <- read.csv("./data/RS_advanced_per48.csv")
data_miscellaneous <- read.csv("./data/RS_miscellaneous_per48.csv")
data_vorp <- read_excel("./data/vorp.xlsx")
MIN_G <- data_traditional_tot$MIN/data_traditional_tot$GP
data_traditional_tot <- cbind(data_traditional_tot, MIN_G)
data_salary <- data_salary[, c(2, 3)]
data_traditional_per48 <- data_traditional_per48[, c(3, 7, 8, 15, 18, 21:32)]
data_traditional_tot <- data_traditional_tot[, c(3, 12, 68)]
data_advanced <- data_advanced[, c(3, 14, 17, 20, 23, 31, 32, 38)]
data_miscellaneous <- data_miscellaneous[, c(3, 24)]
data_vorp <- data_vorp[, c(2, 3, 23, 31, 32)]
names(data_salary)[names(data_salary) == "Player"] <- "PLAYER_NAME"
data_trad_tot <- data_traditional_tot[data_traditional_tot$MIN > 480, ]
data_st <- merge(data_salary, data_traditional_per48, by = "PLAYER_NAME", all = TRUE)
data_ast <- merge(data_st, data_advanced, by = "PLAYER_NAME", all = TRUE)
data_mast <- merge(data_ast, data_miscellaneous, by = "PLAYER_NAME", all = TRUE)
data_mastt <- merge(data_mast, data_trad_tot, by = "PLAYER_NAME", all = TRUE)
final_dataset <- merge(data_mastt, data_vorp, by = "PLAYER_NAME", all = TRUE)
final_dataset <- final_dataset[!is.na(final_dataset$AGE), ]
final_dataset <- final_dataset[!is.na(final_dataset$MIN), ]
final_dataset <- final_dataset[!is.na(final_dataset$VORP), ]
final_dataset
NA_number <- colSums(is.na(final_dataset))
print(NA_number)
final_dataset <- final_dataset[, -17]
colnames(final_dataset)[colnames(final_dataset) == 'PFD.y'] <- 'PFD'
colnames(final_dataset)[colnames(final_dataset) == '2023/24'] <- 'Salary'
final_dataset$Salary <- as.numeric(gsub("[\\$\\,]", "", final_dataset$Salary))
```

```{r datasets-merging, eval=FALSE}
data_st <- merge(data_salary, data_traditional_per48, by = "PLAYER_NAME", all = TRUE)
data_ast <- merge(data_st, data_advanced, by = "PLAYER_NAME", all = TRUE)
data_mast <- merge(data_ast, data_miscellaneous, by = "PLAYER_NAME", all = TRUE)
data_mastt <- merge(data_mast, data_trad_tot, by = "PLAYER_NAME", all = TRUE)
final_dataset <- merge(data_mastt, data_vorp, by = "PLAYER_NAME", all = TRUE)
```

## Data exploration

```{r example-of-dataset, echo=FALSE, warning=FALSE}
library(knitr)
kable(final_dataset[1:5, 1:10], format="simple", align = "llcccccccc")
kable(final_dataset[1:5, 11:20], format="simple", align = "cccccccccc")
kable(final_dataset[1:5, 21:31], format="simple", align = "ccccccccccc")
```










